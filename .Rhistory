names(spl) <- yr12[2:(length(yr12) - 1)]
## interpolation of tree rings ####
L2 <- c(L2, list(L_out))
for (jj in 1:length(spl)) {
spline <- spl[[jj]]
# plot(predict(spline,-180:180))
dL <- L_out - L_in[np, ]  # difference of L_out and L_in
L.ave <- (L_out + L_in[np, ])/2  # average of 2 coordinates
deg_spl <- atan2(L.ave[, 2], L.ave[, 1])/degree  # center angle
ratio_ <- predict(spline, deg_spl)$y
L_cal <- L_in[np, ] + dL * ratio_
lines(L_cal, col = "red")
L2 <- c(L2, list(L_cal))
}
}
L2 <- c(L2, list(L[[length(YRn)]]))  #\tAdd innermost annual ring last
names(L2) <- YR2  ##\tname each annual ring
plot(L[[1]], type = "l", col = "red")
lapply(L2, lines, col = "blue")
points(P$x, P$y, pch = ".", col = "red")
plot(L[[1]], type = "l", col = "red")
lapply(L, lines)
L_out
segments(L_out[, 1], L_out[, 2], L_in[np, 1], L_in[np, 2], col = "blue")
# Construct a object (TR) of classTreeRingShape ####
(wd. <- getwd())              # current working directory
setwd('../Abies_277_h400')      # move to
dir()
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
library(TreeRingShape)
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
# . construct TreeRingShape class ####
#  -. load and  interpolate tree ring shape files ###
TR. <- TreeRingsLines(TR.)
# --- check of each step in TreeRingShape() --- ####
# . generate TreeRingShape class  ####
TR. <- generate_classTreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',
P_ring.tag='ring',
L_ring.tag='ring')
# . check of TreeRingShape class ####
TR.
slotNames(TR.)
str(TR.)
# --- check of each step in TreeRingShape() --- ####
# . generate TreeRingShape class  ####
TR. <- generate_classTreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',
P_ring.tag='ring',
L_ring.tag='ring')
library(TreeRingShape)
# --- check of each step in TreeRingShape() --- ####
# . generate TreeRingShape class  ####
TR. <- generate_classTreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',
P_ring.tag='ring',
L_ring.tag='ring')
help(package="TreeRingShape")
# --- check of each step in TreeRingShape() --- ####
# . generate TreeRingShape class  ####
TR. <- new_classTreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',
P_ring.tag='ring',
L_ring.tag='ring')
# . check of TreeRingShape class ####
TR.
slotNames(TR.)
str(TR.)
# . construct TreeRingShape class ####
#  -. load and  interpolate tree ring shape files ###
TR. <- TreeRingsLines(TR.)
TR. <- TreeRingsPoints(TR.)
TreeRingsLines
ReadShapefile_TreeRings
filename <- '../Abies_277_h400/Abies_277_h400_TreeRing_Representative.shp'
Lplot(ReadShapefile_TreeRings(filename))
#'
#' @return a list of tree ring lines
#' @export
#'
#' @examples
#'\dontrun{
#' filename <- '../Abies_277_h400/Abies_277_h400_TreeRing_Representative.shp'
#' Lplot(ReadShapefile_TreeRings(filename))
#'}
#'
ReadShapefile_TreeRings <- function(filename = "Abies_277_h400_TreeRing_Representative.shp", ring.tag = "ring") {
d <- sf::read_sf(filename)
ring <- data.frame(d)[,ring.tag]
# sorting of tree ring lines
jjj <- order(ring)
ln <- nrow(d)
L <- c()
xy <- st_coordinates(d)
for (i in 1:ln) {
L <- c(L, list(xy[xy[,3]==jjj[i],c(1,2)]) ) #### from data frame to list
}
YR_L <- ring[jjj]
names(L) <- YR_L  # add names of tree rings
return(L)
}
Lplot(ReadShapefile_TreeRings(filename))
library(TreeRingShape)
library(TreeRingShape)
TreeRingsLines
# . construct TreeRingShape class ####
#  -. load and  interpolate tree ring shape files ###
TR. <- TreeRingsLines(TR.)
TR. <- TreeRingShape(TR.)
TR. <- TreeRingShape(TR.)
# tree ring points
TR@P_filename <- P_filename  #'points277_h400'
TR <- new("classTreeRingShape")  # treering_cls #str(TR)
# tree ring points
TR@P_filename <- P_filename  #'points277_h400'
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
TR.
slotNames(TR.)
str(TR.)
dev.new()
Lplot(TR.@L2)
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
library(TreeRingShape)
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
library(TreeRingShape)
setwd('../Abies_277_h400')      # move to
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
TreeRingShape
help(package="TreeRingShape")
TR
slotNames(TR)
TR@P_filename
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
st_coordinates
sf::st_coordinates
file.path <- '../Abies_277_h400/Abies_277_h400_TreeRing_Points.shp'
ReadShapefile_TreeRingPoints(file.path,id.tag='id',ring.tag='ring')
d <- sf::read_sf(filename)
filename = "Abies_277_h400_TreeRing_Points.shp"
d <- sf::read_sf(filename)
xy <- sf::st_coordinates(d)
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
library(TreeRingShape)
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
TR@P00
#'
#' @return TR (TreeRing class TR@L<-L ; TR@L_<-L_ ; TR@YR_L <-YR_L ; TR@ln <- ln)
#' @export
#'
#' @examples
#'  \dontrun{
#'  setwd('../Abies_277_h400')
#'  TR <- TreeRingsLines(TR)
#'  }
#'
TreeRingsLines <- function(TR) {
L <- ReadShapefile_TreeRings(TR@L_filename,ring.tag = "ring")
ln <- length(L)
YR_L <- as.numeric(names(L))
# conversion of coordinate center point to (0,0)
for (i in 1:ln) L[[i]] <- t(t(L[[i]]) - TR@P00)
# plot representative tree rings and measurement points
plot(L[[1]], type = "l", col = "red")
lapply(L, lines)
points(P$x, P$y, pch = ".", col = "red")
abline(h = 0, v = 0, col = "blue")
# Llist2dataframe #
L_ <- Llist2dataframe(L)
# relationships between center angle and distance from center point
x <- L[[1]][, 1]
y <- L[[1]][, 2]
plot(atan2(y, x)/degree, sqrt(x^2 + y^2), type = "n", ylim = c(0, max(P$r, na.rm = TRUE)), xlab = "Center angle (degree)", ylab = "distance from the center point")
for (ii in 1:length(L)) {
x <- L[[ii]][, 1]
y <- L[[ii]][, 2]
points(atan2(y, x)/degree, sqrt(x^2 + y^2), pch = ".")
}
# measurement points
points(P$deg, P$r, col = "red", pch = ".")
TR@L <- L
TR@L_ <- L_
TR@YR_L <- YR_L
TR@ln <- ln
return(TR)
}
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
library(TreeRingShape)
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
library(TreeRingShape)
S
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
library(TreeRingShape)
TR
TR.<-TreeRingShape(
P_filename='Abies_277_h400_TreeRing_Points.shp',
L_filename='Abies_277_h400_TreeRing_Representative.shp',
L2_filename='Abies_277_h400_TreeRing.shp',
P_id.tag='id',P_ring.tag='ring',
L_ring.tag='ring')
TR<-TR.
library(devtools)
save(TR)
save(TR,"TR.RData")
save(TR,file="TR.RData")
save(z=TR,file="z.RData")
load("z.RData")
z
rm(TR)
TR
rm(TR)
TR
z
load("z.RData")
z
dir()
load("z.RData")
TR
ls()
file.remove("z.RData")
dir()
# pdf() ####
tempdir()
# pdf() ####
wd<-getwd()
setwd(tempdir())
pdf("test.pdf")
plot(1:10)
dev.off()
dir()
pdf("test2.pdf")
plot(1:10)
plot((1:10)^2)
dev.off()
dir()
dir()
install.packages("pdftools")
install.packages("poppler-cpp")
install.packages("poppler-cpp")
install.packages("pdftools")
library(pdftools)
dir()
pdf_file <- file.path(R.home("doc"), "NEWS.pdf")
info <- pdf_info(pdf_file)
text <- pdf_text(pdf_file)
fonts <- pdf_fonts(pdf_file)
files <- pdf_attachments(pdf_file)
pdf_file
info
text
fonts
files
dir()
pdf_file <- "test2.pdf"
info <- pdf_info(pdf_file)
pdf_info(pdf_file)
pdf_text(pdf_file)
pdf_fonts(pdf_file)
pdf_attachments(pdf_file)
pdf_ocr_data(pdf_file)
bitmap <- pdf_render_page("news.pdf")
dir()
file.path(Sys.getenv("R_DOC_DIR"), "NEWS.pdf")
pdf_file
f<-file.path(Sys.getenv("R_DOC_DIR"), "NEWS.pdf")
bitmap <- pdf_render_page(f)
bitmap
plot(bitmap)
png::writePNG(bitmap, "page.png")
png::writePNG(bitmap, "page.png")
writePNG
png::writePNG(bitmap, "page2.png",dpi=150)
bitmap <- pdf_render_page(f,dpi=150)
png::writePNG(bitmap, "page2.png",dpi=150)
bitmap <- pdf_render_page(f,dpi=500)
png::writePNG(bitmap, "page2.png")
pdf2png<-function(pdf_file){
info <- pdf_info(pdf_file)
for (i in 1:info$pages){
prinnt(i)
}
}
pdf2png("test2.pdf")
print(i)
pdf2png<-function(pdf_file){
info <- pdf_info(pdf_file)
for (i in 1:info$pages){
print(i)
}
}
pdf2png("test2.pdf")
pdf2png<-function(pdf_file){
for (i in 1:info$pages){
bitmap <- pdf_render_page(f,dpi=500)
png::writePNG(bitmap, paste(substr(10000+i,2,999),".png")
}
paste0(substr(10000+i,2,999),".png")
i<-12
paste0(substr(10000+i,2,999),".png")
pdf2png<-function(pdf_file){
info <- pdf_info(pdf_file)
for (i in 1:info$pages){
bitmap <- pdf_render_page(f,dpi=500)
png::writePNG(bitmap, paste0(substr(10000+i,2,999),".png"))
}
}
pdf2png("test2.pdf")
pdf2png<-function(pdf_file){
info <- pdf_info(pdf_file)
for (i in 1:info$pages){
bitmap <- pdf_render_page(pdf_file,dpi=200)
png::writePNG(bitmap, paste0(substr(10000+i,2,999),".png"))
}
}
pdf2png("test2.pdf")
dir()
dir()
pdf2png("test2.pdf")
dir()
help(package="TreeRingShape")
library(TreeRingShape)
library(shapefiles)
library(sf)
help(package="TreeRingShape")
# cttation ####
citation("sf")
dir()
setwd("~/8T/Dropbox/00D/00/ring/Abies_277_h400")
dir()
setwd("~/8T/Dropbox/00D/00/ring/TreeRingShape/vignettes")
devtools::check()
library(devtools)
devtools::check()
devtools::check()
# devtools.R
# R CMD Rd2pdf TreeRingShape
library(TreeRingShape)
#use_testthat ####
library(testthat)
usethis::use_testthat()
test_check("TreeRingShape")
vignette()
help(package = "TreeRingShape")
vignette(package = "TreeRingShape")
# devtools.R
# R CMD Rd2pdf TreeRingShape
library(TreeRingShape)
library(TreeRingShape)
vignette(package = "TreeRingShape")
vignette("TreeRingFShape")
help(package = "TreeRingShape")
library(devtools)
library(TreeRingShape)
help(package = "TreeRingShape")
# check ####
devtools::check()
library(testthat)
devtools::test()
library(TreeRingShape)
library(devtools)
library(TreeRingShape)
library(testthat)
TR
expect_s4_class(TS, class)
expect_s4_class(TR, class)
expect_s4_class(TR, "S4")
expect_s4_class(TR, "S3")
expect_s4_class(TR, "s4")
x <- data.frame(x = 1:10, y = "x", stringsAsFactors = TRUE)
# A data frame is an S3 object with class data.frame
expect_s3_class(x, "data.frame")
expect_s4_class(x, "data.frame")
show_failure(expect_s4_class(x, "data.frame"))
expect_s4_class(TR@L_, "data.frame")
expect_s4_class(TR, "data.frame")
expect_s3_class(TR@L_, "data.frame")
library(devtools)
library(testthat)
library(TreeRingShape)
library(devtools)
library(testthat)
library(TreeRingShape)
devtools::load_all(".")
TR
sloatName(TR)
slotNames(TR)
TreeRingShape::area(TR@L[[1]])
#slotNames(TR)
test_that("test area",{
expect_equal(TreeRingShape::area(TR@L[[1]]),253029356)
}
)
gc()
# check ####
devtools::check()
# check ####
devtools::check()
library(devtools)
library(testthat)
library(TreeRingShape)
help(package = "TreeRingShape")
# vignette ####
# ヘルプにビニエットのリンクをつける ####   !!!
#  ビルドの後ビルドするとまたなくなる
devtools::install(build_vignettes = TRUE)
help(package = "TreeRingShape")
library(pkgdown)
setwd("~/8T/Dropbox/00D/00/ring/TreeRingShape/tools/html")
dir()
# build_fabicon.R
library(pkgdown)
build_favicons(fabicon.png)
build_favicons("fabicon.png")
build_favicons("favicon.png")
build_favicons(path="favicon.png")
dir()
build_favicons(path="favicon.png")
build_favicons(path = "favicon.png")
usethis::use_pkgdown()
pkgdown::build_favicons()
cd ..
setwd("~/8T/Dropbox/00D/00/ring/TreeRingShape")
pkgdown::build_favicons()
pkgdown::build_site()
usethis::use_pkgdown_github_pages()
usethis::use_pkgdown_github_pages()
# check ####
devtools::check()
devtools::document()
